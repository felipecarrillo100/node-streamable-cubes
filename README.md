
# Grid Data Format with GZIP JSON Chunks and Metadata

This project generates a large grid dataset split into manageable chunks, encoded in JSON format and compressed with gzip for efficient storage and transfer.

---

## Overview

- The grid represents a rectangular area defined by:
  - `originLon`, `originLat`: The longitude and latitude of the grid's origin (bottom-left corner).
  - `width`, `height`: The size of the grid in cells.
  - Each cell represents a fixed spatial size (meters).

- The grid is divided into square chunks (e.g., 64x64 cells per chunk) for easier processing and data transfer.

- Each chunk is serialized to a JSON format Chunk and compressed using gzip.

- A metadata JSON file describes the entire grid and provides a lookup table to find each chunk file.

---

## File Structure

- `g-r{row}c{col}.json.gz` — Each chunk file:
  - `row` and `col` are zero-based chunk indices.
  - Stored as JSON, then gzipped.
  
- `grid-metadata.json` — Index Metadata file describing the entire dataset.

---

## Chunk File Format (`g-r{row}c{col}.json.gz`)

Each chunk contains the following JSON structure before compression:

```json
{
  "lon": number,        // Longitude of bottom-left corner of the chunk
  "lat": number,        // Latitude of bottom-left corner of the chunk
  "width": number,      // Number of cells in chunk width (may be less than chunkSize on edges)
  "height": number,     // Number of cells in chunk height (may be less than chunkSize on edges)
  "cells": [
    {
      "a": boolean,     // Availability flag for the cell
      "o": number,     // Owner ID or 0 if not sold
      "minH": number,   // Minimum height (only if available)
      "maxH": number    // Maximum height (only if available)
    },
    ...
  ]
}
```

- The `cells` array contains `width * height` cells ordered row-wise (y-major order).
- Cells that are not available omit `o`, `minH`, and `maxH` fields.

---

## Metadata File Format (`grid-metadata.json`)

```json
{
  "originLon": number,
  "originLat": number,
  "width": number,
  "height": number,
  "chunkSize": number,
  "totalChunksX": number,
  "totalChunksY": number,
  "boundingBox": [minLon, minLat, maxLon, maxLat],
  "lookup": [
    [ {"file": "g-r0c0.json.gz"}, {"file": "g-r0c1.json.gz"}, ... ],
    [ {"file": "g-r1c0.json.gz"}, {"file": "g-r1c1.json.gz"}, ... ],
    ...
  ]
}
```

- `lookup` is a 2D array indexed by `[row][col]` providing the filename of each chunk.
- `boundingBox` defines the geographic extent of the entire grid in `[minLon, minLat, maxLon, maxLat]`.

---

## How to Use

1. Use the metadata file    to:
   - Understand the overall grid extent and size.
   - Locate chunk files by their row and column indices.
2. Load each chunk file, decompress, and deserialize JSON to access the cell data.
3. The cell data can be used for spatial analysis, rendering, or other applications.

---

## Dependencies and Generation

- The data is generated with Node.js using:
  - [`zlib`](https://nodejs.org/api/zlib.html) for gzip compression.
- Coordinate conversions are done using basic spherical Earth approximations.

---

## Notes

- Chunk sizes are configurable (default 64x64 cells), I have experimented with 100x100, similar results.
- Cells contain minimal fields and short names for efficiency.
- Metadata lookup facilitates direct access to any chunk.
- File names follow the pattern: `g-r{row}c{col}.json.gz`.

---

If you want a sample or the generator script, check the source code in the repository.

---

*Generated by the grid data generation script.*
